<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>SAST - Command Staff Panel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #010409; --sidebar: #0d1117; --card: #161b22; --border: #30363d; --accent: #1f6feb; --danger: #da3633; }
        body { background: var(--bg); color: #c9d1d9; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Login */
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--card); border: 1px solid var(--border); padding: 40px; border-radius: 8px; width: 350px; text-align: center; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 20px; display: none; flex-direction: column; gap: 8px; }
        .sidebar h2 { font-size: 0.7rem; color: #8b949e; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .sidebar button, .sidebar a { background: transparent; border: none; color: #8b949e; text-align: left; padding: 12px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; text-decoration: none; transition: 0.2s; }
        .sidebar button:hover, .sidebar a:hover { background: #1f2937; color: #fff; }
        .sidebar button.active { background: var(--accent); color: #fff; }
        .back-btn { background: #21262d !important; color: #fff !important; margin-bottom: 20px; border: 1px solid var(--border) !important; text-align: center !important; }

        /* Main Content */
        .main { flex: 1; padding: 40px; overflow-y: auto; display: none; }
        h1 { font-weight: 900; text-transform: uppercase; border-left: 5px solid var(--accent); padding-left: 15px; margin-bottom: 30px; color: #fff; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 8px; margin-bottom: 20px; }
        
        label { display: block; margin-bottom: 8px; font-size: 0.8rem; font-weight: bold; color: var(--accent); text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 15px; box-sizing: border-box; font-family: inherit; }
        .action-btn { width: 100%; padding: 15px; background: var(--accent); color: #fff; border: none; border-radius: 6px; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #0d1117; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 10px; }
        .del-btn { background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1>MDT ACCESS</h1>
            <input type="email" id="email" placeholder="Email de service">
            <input type="password" id="pass" placeholder="Mot de passe">
            <button class="action-btn" id="loginBtn">S'IDENTIFIER</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <a href="index.html" class="back-btn">← RETOUR ACCUEIL</a>
        <h2>SAST Command</h2>
        <button onclick="show('sec-defcon')" class="nav-btn active">État d'Alerte (DEFCON)</button>
        <button onclick="show('sec-news')" class="nav-btn">Événements</button>
        <button onclick="show('sec-annonces')" class="nav-btn">Annonces</button>
        <button onclick="show('sec-tabs')" class="nav-btn">Onglets GDoc</button>
        <button onclick="show('sec-design')" class="nav-btn">Design & Logo</button>
        <button onclick="firebase.auth().signOut()" style="margin-top:auto; color:var(--danger);">Déconnexion</button>
    </div>

    <div class="main" id="main-content">
        
        <div id="sec-defcon" class="content-section">
            <h1>Niveau d'Alerte</h1>
            <div class="card">
                <label>Niveau DEFCON</label>
                <select id="defcon-select">
                    <option value="5">DEFCON 5 - Vert</option>
                    <option value="4">DEFCON 4 - Vert Flash</option>
                    <option value="3">DEFCON 3 - Orange/Rouge</option>
                    <option value="2">DEFCON 2 - Rouge Moyen</option>
                    <option value="1">DEFCON 1 - Rouge Pur</option>
                </select>
                <button class="action-btn" onclick="updateDefcon()">Mettre à jour l'alerte</button>
            </div>
        </div>

        <div id="sec-news" class="content-section" style="display:none;">
            <h1>Événements</h1>
            <div class="card">
                <input type="text" id="n-titre" placeholder="Titre">
                <input type="text" id="n-img" placeholder="URL Image (Imgur)">
                <textarea id="n-desc" placeholder="Description" rows="4"></textarea>
                <button class="action-btn" onclick="addEvent()">Publier</button>
            </div>
            <div id="list-events"></div>
        </div>

        <div id="sec-annonces" class="content-section" style="display:none;">
            <h1>Annonces</h1>
            <div class="card">
                <input type="text" id="a-titre" placeholder="Titre">
                <textarea id="a-desc" placeholder="Message" rows="4"></textarea>
                <button class="action-btn" onclick="addItem('annonces', 'a-titre', 'a-desc')">Publier</button>
            </div>
            <div id="list-annonces"></div>
        </div>

        <div id="sec-tabs" class="content-section" style="display:none;">
            <h1>Onglets GDoc</h1>
            <div class="card">
                <input type="text" id="t-titre" placeholder="Nom (Ex: Code Pénal)">
                <input type="text" id="t-url" placeholder="Lien Embed GDoc">
                <button class="action-btn" onclick="addItem('pages', 't-titre', 't-url')">Ajouter l'onglet</button>
            </div>
            <div id="list-tabs"></div>
        </div>

        <div id="sec-design" class="content-section" style="display:none;">
            <h1>Design</h1>
            <div class="card">
                <label>URL du Logo</label>
                <input type="text" id="d-logo" placeholder="Lien Image Logo">
                <label>URL du Fond d'écran</label>
                <input type="text" id="d-bg" placeholder="Lien Image Fond">
                <button class="action-btn" onclick="updateDesign()">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCY-VaTDKe3lJf7pfT2polrunF6r5uEH1I",
            authDomain: "sast-site.firebaseapp.com",
            projectId: "sast-site",
            databaseURL: "https://sast-site-default-rtdb.europe-west1.firebasedatabase.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        document.getElementById('loginBtn').onclick = () => {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value);
        };

        auth.onAuthStateChanged(user => {
            document.getElementById('login-screen').style.display = user ? 'none' : 'flex';
            document.getElementById('sidebar').style.display = user ? 'flex' : 'none';
            document.getElementById('main-content').style.display = user ? 'block' : 'none';
        });

        function show(id) {
            document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(event.target.tagName === "BUTTON") event.target.classList.add('active');
        }

        function updateDefcon() {
            db.ref('defcon').set(parseInt(document.getElementById('defcon-select').value)).then(() => alert("DEFCON OK"));
        }

        function addEvent() {
            const data = { titre: document.getElementById('n-titre').value, img: document.getElementById('n-img').value, desc: document.getElementById('n-desc').value };
            if(data.titre) db.ref('events').push(data).then(() => alert("Event publié"));
        }

        function addItem(path, tId, dId) {
            const data = { titre: document.getElementById(tId).value, desc: document.getElementById(dId).value };
            if(data.titre) db.ref(path).push(data).then(() => alert("Ajouté"));
        }

        function bindList(path, containerId) {
            db.ref(path).on('value', snap => {
                const cont = document.getElementById(containerId); cont.innerHTML = "";
                snap.forEach(c => { cont.innerHTML += `<div class="list-item"><span>${c.val().titre}</span><button class="del-btn" onclick="db.ref('${path}/${c.key}').remove()">Supprimer</button></div>`; });
            });
        }

        bindList('events', 'list-events');
        bindList('annonces', 'list-annonces');
        bindList('pages', 'list-tabs');

        function updateDesign() {
            db.ref('design').update({ logo: document.getElementById('d-logo').value, bgHome: document.getElementById('d-bg').value }).then(() => alert("Design mis à jour"));
        }
    </script>
</body>
</html>
